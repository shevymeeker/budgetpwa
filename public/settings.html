<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <link rel="stylesheet" href="/fa.min.css">
    <link rel="stylesheet" href="/style.css">
    <meta name="theme-color" content="#161514" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#f6f3ee" media="(prefers-color-scheme: light)">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/pwa/icon-192.png">
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'system';
            if (theme === 'light') document.documentElement.setAttribute('data-theme', 'light');
            else if (theme === 'dark') document.documentElement.setAttribute('data-theme', 'dark');
        })();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => navigator.serviceWorker.register('/sw.js'));
        }
    </script>
    <title>ExpenseOwl - Settings</title>
</head>
<body>
    <div class="container">
        <header>
            <div class="nav-bar">
                <a href="/"><img src="/pwa/icon-192.png" alt="ExpenseOwl"></a>
                <a href="/" class="view-button"><i class="fa-solid fa-house"></i></a>
                <a href="/table.html" class="view-button"><i class="fa-solid fa-pen-to-square"></i></a>
                <a href="/settings.html" class="view-button active"><i class="fa-solid fa-gear"></i></a>
            </div>
        </header>

        <div class="settings-section">
            <h2>Currency</h2>
            <div class="setting-row">
                <select id="currencySelect">
                    <option value="usd">USD ($)</option>
                    <option value="eur">EUR (&euro;)</option>
                    <option value="gbp">GBP (&pound;)</option>
                    <option value="jpy">JPY (&yen;)</option>
                    <option value="cny">CNY (&yen;)</option>
                    <option value="inr">INR (&pound;)</option>
                    <option value="cad">CAD ($)</option>
                    <option value="aud">AUD ($)</option>
                    <option value="chf">CHF</option>
                    <option value="sek">SEK (kr)</option>
                    <option value="nok">NOK (kr)</option>
                    <option value="dkk">DKK (kr)</option>
                    <option value="pln">PLN (z&#322;)</option>
                    <option value="czk">CZK (K&#269;)</option>
                    <option value="huf">HUF (Ft)</option>
                    <option value="ron">RON (lei)</option>
                    <option value="bgn">BGN (лв)</option>
                    <option value="hrk">HRK (kn)</option>
                    <option value="try">TRY (&#8378;)</option>
                    <option value="brl">BRL (R$)</option>
                    <option value="mxn">MXN ($)</option>
                    <option value="ars">ARS ($)</option>
                    <option value="cop">COP ($)</option>
                    <option value="krw">KRW (&#8361;)</option>
                    <option value="thb">THB (&#3647;)</option>
                    <option value="idr">IDR (Rp)</option>
                    <option value="myr">MYR (RM)</option>
                    <option value="php">PHP (&#8369;)</option>
                    <option value="sgd">SGD ($)</option>
                    <option value="hkd">HKD ($)</option>
                    <option value="twd">TWD ($)</option>
                    <option value="nzd">NZD ($)</option>
                    <option value="zar">ZAR (R)</option>
                    <option value="aed">AED (د.إ)</option>
                    <option value="sar">SAR (﷼)</option>
                    <option value="ils">ILS (&#8362;)</option>
                    <option value="egp">EGP (E&pound;)</option>
                    <option value="ngn">NGN (&#8358;)</option>
                    <option value="kes">KES (KSh)</option>
                    <option value="uah">UAH (&#8372;)</option>
                    <option value="vnd">VND (&#8363;)</option>
                    <option value="bdt">BDT (&#2547;)</option>
                    <option value="pkr">PKR (&#8360;)</option>
                    <option value="lkr">LKR (Rs)</option>
                    <option value="mmk">MMK (K)</option>
                    <option value="kzt">KZT (&#8376;)</option>
                    <option value="gel">GEL (&#8382;)</option>
                </select>
                <button id="saveCurrency" class="btn-primary">Save</button>
            </div>
        </div>

        <div class="settings-section">
            <h2>Theme</h2>
            <div class="setting-row">
                <select id="themeSelect">
                    <option value="system">System</option>
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                </select>
            </div>
        </div>

        <div class="settings-section">
            <h2>Data</h2>
            <div class="export-group">
                <button id="exportBtn" class="btn-secondary"><i class="fa-solid fa-download"></i>&nbsp; Export backup</button>
                <label class="btn-secondary">
                    <i class="fa-solid fa-upload"></i>&nbsp; Import backup
                    <input type="file" id="importFile" accept=".json" style="display:none;">
                </label>
            </div>
            <div id="importMessage" class="form-message" style="margin-top:0.5rem;"></div>
        </div>

        <nav class="bottom-nav">
            <a href="/" class="bottom-nav-item">
                <i class="fa-solid fa-house"></i><span>Bills</span>
            </a>
            <a href="/table.html" class="bottom-nav-item">
                <i class="fa-solid fa-pen-to-square"></i><span>Manage</span>
            </a>
            <a href="/settings.html" class="bottom-nav-item active">
                <i class="fa-solid fa-gear"></i><span>Settings</span>
            </a>
        </nav>
    </div>

    <script src="/functions.js"></script>
    <script src="/db.js"></script>
    <script>
        async function initialize() {
            const config = await getConfig();
            document.getElementById('currencySelect').value = config.currency;

            const theme = localStorage.getItem('theme') || 'system';
            document.getElementById('themeSelect').value = theme;
        }

        document.getElementById('saveCurrency').addEventListener('click', async () => {
            const currency = document.getElementById('currencySelect').value;
            await updateCurrency(currency);
        });

        document.getElementById('themeSelect').addEventListener('change', (e) => {
            const theme = e.target.value;
            if (theme === 'system') {
                localStorage.removeItem('theme');
                document.documentElement.removeAttribute('data-theme');
            } else {
                localStorage.setItem('theme', theme);
                document.documentElement.setAttribute('data-theme', theme);
            }
        });

        document.getElementById('exportBtn').addEventListener('click', () => exportAllData());

        document.getElementById('importFile').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const msg = document.getElementById('importMessage');
            try {
                const result = await importAllData(file);
                msg.textContent = `Imported ${result.bills} bills, ${result.income} income entries`;
                msg.className = 'form-message success';
            } catch (err) {
                msg.textContent = 'Import failed: ' + err.message;
                msg.className = 'form-message error';
            }
            e.target.value = '';
            setTimeout(() => { msg.textContent = ''; msg.className = 'form-message'; }, 4000);
        });

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
